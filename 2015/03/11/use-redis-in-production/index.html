<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    
    <title>
        use redis in production - redis config set |
        
        舜子</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="##redis config set  since redis 2.0.0, u can use this change setting in redis running config set可以修改哪些配置: config get *   ###注意事项  config set 只能在redis运行时改变配置，但不能改变配置文件里的配置，所以当你在redis运行时，使用了config set，必">
<meta property="og:type" content="article">
<meta property="og:title" content="use redis in production - redis config set">
<meta property="og:url" content="https://dadoudou.me/2015/03/11/use-redis-in-production/">
<meta property="og:site_name" content="舜子">
<meta property="og:description" content="##redis config set  since redis 2.0.0, u can use this change setting in redis running config set可以修改哪些配置: config get *   ###注意事项  config set 只能在redis运行时改变配置，但不能改变配置文件里的配置，所以当你在redis运行时，使用了config set，必">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2015-03-11T05:58:23.000Z">
<meta property="article:modified_time" content="2020-02-02T03:35:41.015Z">
<meta property="article:author" content="zs1621">
<meta name="twitter:card" content="summary">
    
    
    
        
            <link rel="stylesheet" href="https://dadoudou.me/css/markdown.css">
        
            <link rel="stylesheet" href="https://dadoudou.me/css/july.css">
        
    
<meta name="generator" content="Hexo 4.2.0"></head>
<body>

<div id="banner-outer" class="hidden">
    <div id="banner-image" style="background-image: url()"></div>
    <img src="https://www.gravatar.com/avatar/7a585313ed855e8d652cbb3154a6056e?s=300&amp;d=mm&amp;r=g" id="avatar">
</div>

<div id="menu-outer">
    <div id="menu-inner">
        
            <a class="false" href="https://dadoudou.me/index.html">Home</a>
        
            <a class="false" href="https://dadoudou.me/archives/index.html">Archives</a>
        
            <a class="false" href="https://dadoudou.me/about/index.html">About</a>
        
    </div>
</div>

<div id="content-outer" class="container">
    <div id="content-inner">
        <article id="post">
    <h1 id="post-title">use redis in production - redis config set</h1>
    <time id="post-date" datetime="2015-03-11T05:58:23.000Z">
        三月 11, 2015
    </time>
    <div id="post-content" class="markdown-body">
        <p>##redis config set</p>
<ul>
<li>since redis 2.0.0, u can use this change setting in redis running</li>
<li>config set可以修改哪些配置: <code>config get *</code> </li>
</ul>
<p>###注意事项</p>
<ul>
<li>config set 只能在redis运行时改变配置，但不能改变配置文件里的配置，所以当你在redis运行时，使用了config set，必须在对应的配置文件里做修改，否则下次启动时配置又会改变</li>
</ul>
<p>###实战</p>
<ul>
<li>最近的项目里需要对redis数据库做迁移,从系统盘-&gt;数据盘,场景是只使用了RDB持久化</li>
<li>使用config set dir 需注意</li>
</ul>
<pre><code>rdb将内存中的数据库以RDB格式保存到磁盘中，如果RDB文件已存在，那么新的RDB文件写好将会替换为已有的RDB文件。
在保存RDB文件期间，主进程会被调用rdbsave函数 
bgsave过程fork出一个子进程，子进程负责调用rdbSave,并在保存完成之后向主进程发送信号，通知保存已完成
save过程直接调用rdbSave,阻塞Redis主进程，知道保存完为止。在主进程阻塞期间，服务器不能处理客户端的任何请求。
这里有两个坑
1. fork是有延迟的 [](http://blog.nosqlfan.com/html/3903.html)
2. RDB在写入过程中，会连内存一起Fork出一个新进程，遍历新进程内存中的数据写RDB. 注意fork的时候一定要注意当前机子的内存，保险的话是2倍现有redis所占内存.</code></pre><ul>
<li>dump.rdb 从 /var/lib/redis/ ， 转存到/mnt/lib/redis/</li>
<li>redis-cli</li>
<li>config set dir /mnt/lib/redis #这里要注意redis进程是属于哪个用户的, 要把/mnt/lib/redis设为此用户可写可读的</li>
<li>bgsave  #当看到/mnt/lib/redis 里有dump.rdb(默认)文件时就表明操作成功</li>
<li>此时再修改 redis.conf 将 dir -&gt; /mnt/lib/redis</li>
<li>如果下次重启的话， redis将会从 /mnt/lib/redis/dump.rdb 读入数据到内存中  #注意如果要重启，最好先把业务逻辑相关的redis处理关掉，防止数据丢失，并且通过shutdown 关闭，不要kill -9。</li>
</ul>
<h3 id="config-set-还可以修改很多参数这里不一一解释等以后用到再做解释TBC"><a href="#config-set-还可以修改很多参数这里不一一解释等以后用到再做解释TBC" class="headerlink" title="config set 还可以修改很多参数这里不一一解释等以后用到再做解释TBC"></a>config set 还可以修改很多参数这里不一一解释等以后用到再做解释TBC</h3>
    </div>
</article>

<div id="gitalk-container">
    <link rel="stylesheet" href="https://unpkg.com/gitalk@1.6.2/dist/gitalk.css">
<script src="https://geektutu.github.io/hexo-theme-geektutu/js/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
//         clientID: '01408711d79d72f03315',
//         clientSecret: '238abe81d923c8392d36e3cdb14d29961f1870b2',
        accessToken: '997eb7f03bafcfef0d6b3030543c5a6e903fb771',
        id: window.location.pathname,
        repo: 'dadoudou.me',
        owner: 'zs1621',
        admin: 'zs1621',
        distractionFreeMode: 'true'
    })
    gitalk.render('gitalk-container')
</script>
</div>

<div id="paginator">
    
</div>


    </div>
</div>

<div id="bottom-outer">
    <div id="bottom-inner">
        2019-2020 zs1621 
    </div>
</div>

<div id="to-top">
    <i class="iconfont icon-up"></i>
</div>


    
        <script src="https://dadoudou.me/js/jquery-3.4.1.min.js"></script>
    
        <script src="https://dadoudou.me/js/highlight-9.13.1.min.js"></script>
    
        <script src="https://dadoudou.me/js/transition.js"></script>
    
        <script src="https://dadoudou.me/js/smooth-scroll.min.js"></script>
    



    <script>
      $(function () {
        $('#banner-outer').addClass('fade-out')
        $('#menu-outer').addClass('fade-show')

        $('pre').each(function (i, block) {
          hljs.highlightBlock(block);
        });
      })
    </script>


<script>
  $(function () {
    $(window).scroll(function () {
      if ($(window).scrollTop() > 150) {
        $("#to-top").fadeIn();
      } else {
        $("#to-top").fadeOut();
      }
    });
    $("#to-top").click(function () {
      $("body,html").animate({scrollTop: 0}, 500);
      return false;
    })
  })
</script>
</body>
</html>
